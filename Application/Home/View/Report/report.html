<if condition="!IS_PJAX">
<include file="Public/header" />
<include file="Public/nav" />
</if>
<link rel="stylesheet" href="__PUBLIC__/assets/css/amazeui.chosen.css"/>
<div class="am-container">
<notempty name="tips">
<div class="am-alert am-alert-default" data-am-alert>
  <button type="button" class="am-close">&times;</button>
  <p>{$tips}</p>
</div>
</notempty>
<form action="{:U('Report/index')}" method="post" class="am-form" data-am-validator>
  <fieldset>
    <div class="am-form-group">
      <label>报修区域：</label>
      <select id="province" name="area" required>
        <option value="载入中">载入中</option>
      </select>                     
    </div>

    <div class="am-form-group">
      <label>报修楼栋：</label>
      <select id="city" name="building" required>
        <option value="载入中">载入中</option>
      </select>        
    </div>

    <div class="am-form-group">
      <label for="report-2">报修地点：</label>
      <input type="text" id="report-2" name="location" maxlength="20" placeholder="请输入具体地址（详细到房间号）" value="{$user['location']}" required/>
    </div>

    <div class="am-form-group">
      <label for="tel">联系电话：</label>
      <input type="text" id="tel" name="tel" placeholder="请输入11位国内手机电话号码" class="js-pattern-mobile" value="{$user['tel']}" required/>
    </div>    

    <div class="am-form-group">
      <label class="am-form-label">报修物品：</label>
      <input type="text" minlength="2" placeholder="请填写报修物品" maxlength="20" name="good" required/>
    </div>

    <div class="am-form-group">
      <label for="report-5">故障描述：</label>
      <textarea id="report-5" name="description" maxlength="150" rows="5" placeholder="请具体描述故障（选填）"></textarea>
    </div>

    <button class="am-btn am-btn-secondary am-btn-block am-radius" type="submit">提 交</button>
  </fieldset>
</form>
</div>
<script type="text/javascript">
$.getScript("__PUBLIC__/assets/js/jquery.city.select.js", function() {
	var data = {$data};
	$('#province, #city').citylist({
		data: data,
		id: 'id',
		children: 'citys',
		name: 'name',
		metaTag: 'name'
	});
});
if ($.AMUI && $.AMUI.validator) {
	$.AMUI.validator.patterns.mobile = /^1((3|5|8){1}\d{1}|70)\d{8}$/
}
$('form').validator({
	onValid: function(validity) {
		$(validity.field).closest('.am-form-group').find('.am-alert').hide()
	},
	onInValid: function(validity) {
		var $field = $(validity.field);
		var $group = $field.closest('.am-form-group');
		var $alert = $group.find('.am-alert');
		var msg = $field.data('validationMessage') || this.getValidationMessage(validity);
		if (!$alert.length) {
			$alert = $('<div class="am-alert am-alert-danger"></div>').hide().appendTo($group)
		}
		$alert.html(msg).show()
	}
});
$.getScript("__PUBLIC__/resource/js/jquery.timers.min.js", function() {
	$(document).stopTime();	
	$(document).oneTime('1das',function(){
		$('#province').find('option[value="{$user['area']}"]').attr('selected', true);
		if (!$.AMUI.support.mutationobserver) {
			$('#province').trigger('changed.selected.amui')
		}
		$('#city').find('option[value="{$user['building']}"]').attr('selected', 'selected');
		if (!$.AMUI.support.mutationobserver) {
			$('#city').trigger('changed.selected.amui')
		}		
	});	
	<if condition="!empty(cookie('last_normal_report'))">
	var time = 60;
	$(document).everyTime('1s',function(){
		time--;
		$("fieldset>button[type=submit]").attr('disabled', 'disabled').text(time);
		if (time <= 0)$("fieldset>button[type=submit]").removeAttr('disabled').text('提 交');
	},60);
	</if>
});
</script>
<script type="text/javascript">
$(function(){$(".am-topbar-nav").find('.am-active:not(.am-dropdown)').removeClass('am-active');$(".am-topbar-nav").find("a[href='<?=U()?>']").parent().addClass('am-active')});
if(document.getElementsByTagName('meta').length==0)window.location.href="__SELF__";
</script>
<if condition="!IS_PJAX">
<include file="Public/footer" />
</if>